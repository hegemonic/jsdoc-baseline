var jqtree=function(e){"use strict";function i(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){l(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=h(n);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(this,i?(e=h(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function t(){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(i){t=Object.getOwnPropertyDescriptor(i,t);return t.get?t.get.call(arguments.length<3?e:n):t.value}}).apply(this,arguments)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);s=!0);}catch(e){a=!0,o=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,t=function(){};return{s:t,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}var y;(K=y=y||{})[K.Before=1]="Before",K[K.After=2]="After",K[K.Inside=3]="Inside",K[K.None=4]="None";function k(e){for(var t in _)if(Object.prototype.hasOwnProperty.call(_,t)&&_[t]===e)return t;return""}function N(e){return"object"===u(e)&&"children"in e&&e.children instanceof Array}function S(e){return e?"true":"false"}var _={before:y.Before,after:y.After,inside:y.Inside,none:y.None},b=(n(A,[{key:"setData",value:function(e){if(e)if("string"==typeof e)this.name=e;else if("object"===u(e))for(var t in e){var n;Object.prototype.hasOwnProperty.call(e,t)&&(n=e[t],"label"===t||"name"===t?"string"==typeof n&&(this.name=n):"children"!==t&&"parent"!==t&&(this[t]=n))}}},{key:"loadFromData",value:function(e){this.removeChildren();var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=this.createNode(i);this.addChild(o),N(i)&&(0===i.children.length?o.isEmptyFolder=!0:o.loadFromData(i.children))}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"addChild",value:function(e){this.children.push(e),e.setParent(this)}},{key:"addChildAtPosition",value:function(e,t){this.children.splice(t,0,e),e.setParent(this)}},{key:"removeChild",value:function(e){e.removeChildren(),this.doRemoveChild(e)}},{key:"getChildIndex",value:function(e){return this.children.indexOf(e)}},{key:"hasChildren",value:function(){return 0!==this.children.length}},{key:"isFolder",value:function(){return this.hasChildren()||this.load_on_demand}},{key:"iterate",value:function(s){!function e(t,n){if(t.children){var i,o=m(t.children);try{for(o.s();!(i=o.n()).done;){var r=i.value;s(r,n)&&r.hasChildren()&&e(r,n+1)}}catch(e){o.e(e)}finally{o.f()}}}(this,0)}},{key:"moveNode",value:function(e,t,n){if(!e.parent||e.isParentOf(t))return!1;switch(e.parent.doRemoveChild(e),n){case y.After:return!!t.parent&&(t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)+1),!0);case y.Before:return!!t.parent&&(t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)),!0);case y.Inside:return t.addChildAtPosition(e,0),!0;default:return!1}}},{key:"getData",value:function(){return function o(e){return e.map(function(e){var t,n,i={};for(t in e)-1===["parent","children","element","idMapping","load_on_demand","nodeClass","tree","isEmptyFolder"].indexOf(t)&&Object.prototype.hasOwnProperty.call(e,t)&&(n=e[t],i[t]=n);return e.hasChildren()&&(i.children=o(e.children)),i})}(0<arguments.length&&void 0!==arguments[0]&&arguments[0]?[this]:this.children)}},{key:"getNodeByName",value:function(t){return this.getNodeByCallback(function(e){return e.name===t})}},{key:"getNodeByNameMustExist",value:function(t){var e=this.getNodeByCallback(function(e){return e.name===t});if(!e)throw"Node with name ".concat(t," not found");return e}},{key:"getNodeByCallback",value:function(t){var n=null;return this.iterate(function(e){return!(n||t(e)&&(n=e,1))}),n}},{key:"addAfter",value:function(e){if(this.parent){var t=this.createNode(e),n=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(t,n+1),N(e)&&e.children.length&&t.loadFromData(e.children),t}return null}},{key:"addBefore",value:function(e){if(this.parent){var t=this.createNode(e),n=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(t,n),N(e)&&e.children.length&&t.loadFromData(e.children),t}return null}},{key:"addParent",value:function(e){if(this.parent){var t=this.createNode(e);this.tree&&t.setParent(this.tree);var n,i=this.parent,o=m(i.children);try{for(o.s();!(n=o.n()).done;){var r=n.value;t.addChild(r)}}catch(e){o.e(e)}finally{o.f()}return i.children=[],i.addChild(t),t}return null}},{key:"remove",value:function(){this.parent&&(this.parent.removeChild(this),this.parent=null)}},{key:"append",value:function(e){var t=this.createNode(e);return this.addChild(t),N(e)&&e.children.length&&t.loadFromData(e.children),t}},{key:"prepend",value:function(e){var t=this.createNode(e);return this.addChildAtPosition(t,0),N(e)&&e.children.length&&t.loadFromData(e.children),t}},{key:"isParentOf",value:function(e){for(var t=e.parent;t;){if(t===this)return!0;t=t.parent}return!1}},{key:"getLevel",value:function(){for(var e=0,t=this;t.parent;)e+=1,t=t.parent;return e}},{key:"getNodeById",value:function(e){return this.idMapping.get(e)||null}},{key:"addNodeToIndex",value:function(e){null!=e.id&&this.idMapping.set(e.id,e)}},{key:"removeNodeFromIndex",value:function(e){null!=e.id&&this.idMapping.delete(e.id)}},{key:"removeChildren",value:function(){var n=this;this.iterate(function(e){var t;return null===(t=n.tree)||void 0===t||t.removeNodeFromIndex(e),!0}),this.children=[]}},{key:"getPreviousSibling",value:function(){if(this.parent){var e=this.parent.getChildIndex(this)-1;return 0<=e?this.parent.children[e]:null}return null}},{key:"getNextSibling",value:function(){if(this.parent){var e=this.parent.getChildIndex(this)+1;return e<this.parent.children.length?this.parent.children[e]:null}return null}},{key:"getNodesByProperty",value:function(t,n){return this.filter(function(e){return e[t]===n})}},{key:"filter",value:function(t){var n=[];return this.iterate(function(e){return t(e)&&n.push(e),!0}),n}},{key:"getNextNode",value:function(){return 0<arguments.length&&void 0!==arguments[0]&&!arguments[0]||!this.hasChildren()||!this.is_open?this.parent?this.getNextSibling()||this.parent.getNextNode(!1):null:this.children[0]}},{key:"getPreviousNode",value:function(){if(this.parent){var e=this.getPreviousSibling();return e?e.hasChildren()&&e.is_open?e.getLastChild():e:this.getParent()}return null}},{key:"getParent",value:function(){return this.parent&&this.parent.parent?this.parent:null}},{key:"getLastChild",value:function(){if(this.hasChildren()){var e=this.children[this.children.length-1];return e.hasChildren()&&e.is_open?e.getLastChild():e}return null}},{key:"initFromData",value:function(e){var r=this,e=e;r.setData(e),N(e)&&e.children.length&&function(e){var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=r.createNode();o.initFromData(i),r.addChild(o)}}catch(e){n.e(e)}finally{n.f()}}(e.children)}},{key:"setParent",value:function(e){this.parent=e,this.tree=e.tree,null===(e=this.tree)||void 0===e||e.addNodeToIndex(this)}},{key:"doRemoveChild",value:function(e){var t;this.children.splice(this.getChildIndex(e),1),null===(t=this.tree)||void 0===t||t.removeNodeFromIndex(e)}},{key:"getNodeClass",value:function(){var e;return this.nodeClass||(null==this||null===(e=this.tree)||void 0===e?void 0:e.nodeClass)||A}},{key:"createNode",value:function(e){return new(this.getNodeClass())(e)}}]),A),D=(n(P,[{key:"mouseCapture",value:function(e){e=jQuery(e.target);if(!this.mustCaptureElement(e))return null;if(this.treeWidget.options.onIsMoveHandle&&!this.treeWidget.options.onIsMoveHandle(e))return null;e=this.treeWidget._getNodeElement(e);return e&&this.treeWidget.options.onCanMove&&(this.treeWidget.options.onCanMove(e.node)||(e=null)),this.currentItem=e,null!=this.currentItem}},{key:"mouseStart",value:function(e){if(!this.currentItem||void 0===e.pageX||void 0===e.pageY)return!1;this.refresh();var t=jQuery(e.target).offset(),n=t?t.left:0,i=t?t.top:0,t=this.currentItem.node;return this.dragElement=new j(t.name,e.pageX-n,e.pageY-i,this.treeWidget.element,null===(i=this.treeWidget.options.autoEscape)||void 0===i||i),this.isDragging=!0,this.positionInfo=e,this.currentItem.$element.addClass("jqtree-moving"),!0}},{key:"mouseDrag",value:function(e){if(!this.currentItem||!this.dragElement||void 0===e.pageX||void 0===e.pageY)return!1;this.dragElement.move(e.pageX,e.pageY),this.positionInfo=e;var t=this.findHoveredArea(e.pageX,e.pageY);return t&&this.canMoveToArea(t)?(t.node.isFolder()||this.stopOpenFolderTimer(),this.hoveredArea!==t&&(this.hoveredArea=t,this.mustOpenFolderTimer(t)?this.startOpenFolderTimer(t.node):this.stopOpenFolderTimer(),this.updateDropHint())):(this.removeDropHint(),this.stopOpenFolderTimer(),this.hoveredArea=t),t||this.treeWidget.options.onDragMove&&this.treeWidget.options.onDragMove(this.currentItem.node,e.originalEvent),!0}},{key:"mouseStop",value:function(e){this.moveItem(e),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas();var t=this.currentItem;return this.currentItem&&(this.currentItem.$element.removeClass("jqtree-moving"),this.currentItem=null),this.isDragging=!1,this.positionInfo=null,!this.hoveredArea&&t&&this.treeWidget.options.onDragStop&&this.treeWidget.options.onDragStop(t.node,e.originalEvent),!1}},{key:"refresh",value:function(){this.removeHitAreas(),this.currentItem&&(this.generateHitAreas(),this.currentItem=this.treeWidget._getNodeElementForNode(this.currentItem.node),this.isDragging&&this.currentItem.$element.addClass("jqtree-moving"))}},{key:"generateHitAreas",value:function(){var e;this.currentItem?(e=new I(this.treeWidget.tree,this.currentItem.node,this.getTreeDimensions().bottom),this.hitAreas=e.generate()):this.hitAreas=[]}},{key:"mustCaptureElement",value:function(e){return!e.is("input,select,textarea")}},{key:"canMoveToArea",value:function(e){if(!this.treeWidget.options.onCanMoveTo)return!0;if(!this.currentItem)return!1;var t=k(e.position);return this.treeWidget.options.onCanMoveTo(this.currentItem.node,e.node,t)}},{key:"removeHitAreas",value:function(){this.hitAreas=[]}},{key:"clear",value:function(){this.dragElement&&(this.dragElement.remove(),this.dragElement=null)}},{key:"removeDropHint",value:function(){this.previousGhost&&this.previousGhost.remove()}},{key:"removeHover",value:function(){this.hoveredArea=null}},{key:"findHoveredArea",value:function(e,t){var n=this.getTreeDimensions();if(e<n.left||t<n.top||e>n.right||t>n.bottom)return null;for(var i=0,o=this.hitAreas.length;i<o;){var r=i+o>>1,s=this.hitAreas[r];if(t<s.top)o=r;else{if(!(t>s.bottom))return s;i=1+r}}return null}},{key:"mustOpenFolderTimer",value:function(e){var t=e.node;return t.isFolder()&&!t.is_open&&e.position===y.Inside}},{key:"updateDropHint",value:function(){var e;this.hoveredArea&&(this.removeDropHint(),e=this.treeWidget._getNodeElementForNode(this.hoveredArea.node),this.previousGhost=e.addDropHint(this.hoveredArea.position))}},{key:"startOpenFolderTimer",value:function(e){var t=this;this.stopOpenFolderTimer();var n=this.treeWidget.options.openFolderDelay;!1!==n&&(this.openFolderTimer=window.setTimeout(function(){t.treeWidget._openNode(e,t.treeWidget.options.slide,function(){t.refresh(),t.updateDropHint()})},n))}},{key:"stopOpenFolderTimer",value:function(){this.openFolderTimer&&(clearTimeout(this.openFolderTimer),this.openFolderTimer=null)}},{key:"moveItem",value:function(e){var t,n,i,o,r,s=this;this.currentItem&&this.hoveredArea&&this.hoveredArea.position!==y.None&&this.canMoveToArea(this.hoveredArea)&&(t=this.currentItem.node,n=this.hoveredArea.node,i=this.hoveredArea.position,o=t.parent,i===y.Inside&&(this.hoveredArea.node.is_open=!0),r=function(){s.treeWidget.tree.moveNode(t,n,i),s.treeWidget.element.empty(),s.treeWidget._refreshElements(null)},this.treeWidget._triggerEvent("tree.move",{move_info:{moved_node:t,target_node:n,position:k(i),previous_parent:o,do_move:r,original_event:e.originalEvent}}).isDefaultPrevented()||r())}},{key:"getTreeDimensions",value:function(){var e=this.treeWidget.element.offset();if(e){var t=this.treeWidget.element,n=t.width()||0,i=t.height()||0,t=e.left+this.treeWidget._getScrollLeft();return{left:t,top:e.top,right:t+n,bottom:e.top+i+16}}return{left:0,top:0,right:0,bottom:0}}}]),P),I=function(){d(o,function(){function t(e){a(this,t),l(this,"tree",void 0),this.tree=e}return n(t,[{key:"iterate",value:function(){var s=this,a=!0;!function n(i,e){var t=(i.is_open||!i.element)&&i.hasChildren(),o=null;if(i.element){if(!(o=jQuery(i.element)).is(":visible"))return;a&&(s.handleFirstNode(i),a=!1),i.hasChildren()?i.is_open?s.handleOpenFolder(i,o)||(t=!1):s.handleClosedFolder(i,e,o):s.handleNode(i,e,o)}if(t){var r=i.children.length;i.children.forEach(function(e,t){n(i.children[t],t===r-1?null:i.children[t+1])}),i.is_open&&o&&s.handleAfterOpenFolder(i,e)}}(this.tree,null)}}]),t}());var i=v(o);function o(e,t,n){return a(this,o),l(c(e=i.call(this,e)),"currentNode",void 0),l(c(e),"treeBottom",void 0),l(c(e),"positions",void 0),l(c(e),"lastTop",void 0),e.currentNode=t,e.treeBottom=n,e}return n(o,[{key:"generate",value:function(){return this.positions=[],this.lastTop=0,this.iterate(),this.generateHitAreas(this.positions)}},{key:"generateHitAreas",value:function(e){var t,n=-1,i=[],o=[],r=m(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;s.top!==n&&i.length&&(i.length&&this.generateHitAreasForGroup(o,i,n,s.top),n=s.top,i=[]),i.push(s)}}catch(e){r.e(e)}finally{r.f()}return this.generateHitAreasForGroup(o,i,n,this.treeBottom),o}},{key:"handleOpenFolder",value:function(e,t){return e!==this.currentNode&&(e.children[0]!==this.currentNode&&this.addPosition(e,y.Inside,this.getTop(t)),!0)}},{key:"handleClosedFolder",value:function(e,t,n){n=this.getTop(n);e===this.currentNode?this.addPosition(e,y.None,n):(this.addPosition(e,y.Inside,n),t!==this.currentNode&&this.addPosition(e,y.After,n))}},{key:"handleFirstNode",value:function(e){e!==this.currentNode&&this.addPosition(e,y.Before,this.getTop(jQuery(e.element)))}},{key:"handleAfterOpenFolder",value:function(e,t){e===this.currentNode||t===this.currentNode?this.addPosition(e,y.None,this.lastTop):this.addPosition(e,y.After,this.lastTop)}},{key:"handleNode",value:function(e,t,n){n=this.getTop(n);e===this.currentNode?this.addPosition(e,y.None,n):this.addPosition(e,y.Inside,n),t===this.currentNode||e===this.currentNode?this.addPosition(e,y.None,n):this.addPosition(e,y.After,n)}},{key:"getTop",value:function(e){e=e.offset();return e?e.top:0}},{key:"addPosition",value:function(e,t,n){this.positions.push({top:n,bottom:0,node:e,position:t}),this.lastTop=n}},{key:"generateHitAreasForGroup",value:function(e,t,n,i){for(var o=Math.min(t.length,4),r=Math.round((i-n)/o),s=n,a=0;a<o;){var l=t[a];e.push({top:s,bottom:s+r,node:l.node,position:l.position}),s+=r,a+=1}}}]),o}(),j=(n(L,[{key:"move",value:function(e,t){this.$element.offset({left:e-this.offsetX,top:t-this.offsetY})}},{key:"remove",value:function(){this.$element.remove()}}]),L),E=(n(T,[{key:"render",value:function(e){e&&e.parent?this.renderFromNode(e):this.renderFromRoot()}},{key:"renderFromRoot",value:function(){var e=this.treeWidget.element;e.empty(),this.createDomElements(e[0],this.treeWidget.tree.children,!0,1)}},{key:"renderFromNode",value:function(e){var t=jQuery(e.element),n=this.createLi(e,e.getLevel());this.attachNodeData(e,n),t.after(n),t.remove(),e.children&&this.createDomElements(n,e.children,!1,e.getLevel()+1)}},{key:"createDomElements",value:function(e,t,n,i){var o=this.createUl(n);e.appendChild(o);var r,s=m(t);try{for(s.s();!(r=s.n()).done;){var a=r.value,l=this.createLi(a,i);o.appendChild(l),this.attachNodeData(a,l),a.hasChildren()&&this.createDomElements(l,a.children,!1,i+1)}}catch(e){s.e(e)}finally{s.f()}}},{key:"attachNodeData",value:function(e,t){e.element=t,jQuery(t).data("node",e)}},{key:"createUl",value:function(e){var t,n;e?(t="jqtree-tree",n="tree",this.treeWidget.options.rtl&&(t+=" jqtree-rtl")):(t="",n="group"),this.treeWidget.options.dragAndDrop&&(t+=" jqtree-dnd");e=document.createElement("ul");return e.className="jqtree_common ".concat(t),e.setAttribute("role",n),e}},{key:"createLi",value:function(e,t){var n=Boolean(this.treeWidget.selectNodeHandler.isNodeSelected(e)),t=e.isFolder()||e.isEmptyFolder&&this.treeWidget.options.showEmptyFolder?this.createFolderLi(e,t,n):this.createNodeLi(e,t,n);return this.treeWidget.options.onCreateLi&&this.treeWidget.options.onCreateLi(e,jQuery(t),n),t}},{key:"createFolderLi",value:function(e,t,n){var i=this.getButtonClasses(e),o=this.getFolderClasses(e,n),r=e.is_open?this.openedIconElement:this.closedIconElement,s=document.createElement("li");s.className="jqtree_common ".concat(o),s.setAttribute("role","presentation");var a=document.createElement("div");a.className="jqtree-element jqtree_common",a.setAttribute("role","presentation"),s.appendChild(a);o=document.createElement("a");return o.className=i,o.appendChild(r.cloneNode(!0)),o.setAttribute("role","presentation"),o.setAttribute("aria-hidden","true"),this.treeWidget.options.buttonLeft&&a.appendChild(o),a.appendChild(this.createTitleSpan(e.name,t,n,e.is_open,!0)),this.treeWidget.options.buttonLeft||a.appendChild(o),s}},{key:"createNodeLi",value:function(e,t,n){var i=["jqtree_common"];n&&i.push("jqtree-selected");var o=i.join(" "),i=document.createElement("li");i.className=o,i.setAttribute("role","presentation");o=document.createElement("div");return o.className="jqtree-element jqtree_common",o.setAttribute("role","presentation"),i.appendChild(o),o.appendChild(this.createTitleSpan(e.name,t,n,e.is_open,!1)),i}},{key:"createTitleSpan",value:function(e,t,n,i,o){var r,s=document.createElement("span"),a="jqtree-title jqtree_common";return o&&(a+=" jqtree-title-folder"),a+=" jqtree-title-button-".concat(this.treeWidget.options.buttonLeft?"left":"right"),s.className=a,s.setAttribute("role","treeitem"),s.setAttribute("aria-level","".concat(t)),s.setAttribute("aria-selected",S(n)),s.setAttribute("aria-expanded",S(i)),n&&void 0!==(r=this.treeWidget.options.tabIndex)&&s.setAttribute("tabindex","".concat(r)),this.treeWidget.options.autoEscape?s.textContent=e:s.innerHTML=e,s}},{key:"getButtonClasses",value:function(e){var t=["jqtree-toggler","jqtree_common"];return e.is_open||t.push("jqtree-closed"),this.treeWidget.options.buttonLeft?t.push("jqtree-toggler-left"):t.push("jqtree-toggler-right"),t.join(" ")}},{key:"getFolderClasses",value:function(e,t){var n=["jqtree-folder"];return e.is_open||n.push("jqtree-closed"),t&&n.push("jqtree-selected"),e.is_loading&&n.push("jqtree-loading"),n.join(" ")}},{key:"createButtonElement",value:function(e){if("string"!=typeof e)return jQuery(e)[0];var t=document.createElement("div");return t.innerHTML=e,document.createTextNode(t.innerHTML)}}]),T),C=(n(W,[{key:"loadFromUrl",value:function(e,t,n){var i,o,r=this;e&&(i=this.getDomElement(t),this.addLoadingClass(i),this.notifyLoading(!0,t,i),o=function(){r.removeLoadingClass(i),r.notifyLoading(!1,t,i)},this.submitRequest(e,function(e){o(),r.treeWidget.loadData(r.parseData(e),t),n&&"function"==typeof n&&n()},function(e){o(),r.treeWidget.options.onLoadFailed&&r.treeWidget.options.onLoadFailed(e)}))}},{key:"addLoadingClass",value:function(e){e&&e.addClass("jqtree-loading")}},{key:"removeLoadingClass",value:function(e){e&&e.removeClass("jqtree-loading")}},{key:"getDomElement",value:function(e){return e?jQuery(e.element):this.treeWidget.element}},{key:"notifyLoading",value:function(e,t,n){this.treeWidget.options.onLoading&&this.treeWidget.options.onLoading(e,t,n),this.treeWidget._triggerEvent("tree.loading_data",{isLoading:e,node:t,$el:n})}},{key:"submitRequest",value:function(e,t,n){n=s({method:"GET",cache:!1,dataType:"json",success:t,error:n},"string"==typeof e?{url:e}:e);n.method=(null===(e=n.method)||void 0===e?void 0:e.toUpperCase())||"GET",jQuery.ajax(n)}},{key:"parseData",value:function(e){var t=this.treeWidget.options.dataFilter,e="string"==typeof e?JSON.parse(e):e;return t?t(e):e}}]),W),w=(n(F,[{key:"deinit",value:function(){jQuery(document).off("keydown.jqtree")}},{key:"moveDown",value:function(e){return this.selectNode(e.getNextNode())}},{key:"moveUp",value:function(e){return this.selectNode(e.getPreviousNode())}},{key:"moveRight",value:function(e){return!e.isFolder()||(e.is_open?this.selectNode(e.getNextNode()):(this.treeWidget.openNode(e),!1))}},{key:"moveLeft",value:function(e){return e.isFolder()&&e.is_open?(this.treeWidget.closeNode(e),!1):this.selectNode(e.getParent())}},{key:"selectNode",value:function(e){return!e||(this.treeWidget.selectNode(e),this.treeWidget.scrollHandler.isScrolledIntoView(jQuery(e.element).find(".jqtree-element"))||this.treeWidget.scrollToNode(e),!1)}},{key:"canHandleKeyboard",value:function(){return!!this.treeWidget.options.keyboardSupport&&this.treeWidget.selectNodeHandler.isFocusOnTree()}}]),F);function F(e){var n=this;a(this,F),l(this,"treeWidget",void 0),l(this,"handleKeyDown",function(e){if(!n.canHandleKeyboard())return!0;var t=n.treeWidget.getSelectedNode();if(!t)return!0;switch(e.which){case F.DOWN:return n.moveDown(t);case F.UP:return n.moveUp(t);case F.RIGHT:return n.moveRight(t);case F.LEFT:return n.moveLeft(t);default:return!0}}),(this.treeWidget=e).options.keyboardSupport&&jQuery(document).on("keydown.jqtree",this.handleKeyDown)}function W(e){a(this,W),l(this,"treeWidget",void 0),this.treeWidget=e}function T(e){a(this,T),l(this,"openedIconElement",void 0),l(this,"closedIconElement",void 0),l(this,"treeWidget",void 0),this.treeWidget=e,this.openedIconElement=this.createButtonElement(e.options.openedIcon||"+"),this.closedIconElement=this.createButtonElement(e.options.closedIcon||"-")}function L(e,t,n,i,o){a(this,L),l(this,"offsetX",void 0),l(this,"offsetY",void 0),l(this,"$element",void 0),this.offsetX=t,this.offsetY=n,this.$element=jQuery("<span>").addClass("jqtree-title jqtree-dragging"),o?this.$element.text(e):this.$element.html(e),this.$element.css("position","absolute"),i.append(this.$element)}function P(e){a(this,P),l(this,"hitAreas",void 0),l(this,"isDragging",void 0),l(this,"currentItem",void 0),l(this,"hoveredArea",void 0),l(this,"positionInfo",void 0),l(this,"treeWidget",void 0),l(this,"dragElement",void 0),l(this,"previousGhost",void 0),l(this,"openFolderTimer",void 0),this.treeWidget=e,this.hoveredArea=null,this.hitAreas=[],this.isDragging=!1,this.currentItem=null,this.positionInfo=null}function A(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:A;a(this,A),l(this,"id",void 0),l(this,"name",void 0),l(this,"children",void 0),l(this,"parent",void 0),l(this,"idMapping",void 0),l(this,"tree",void 0),l(this,"nodeClass",void 0),l(this,"load_on_demand",void 0),l(this,"is_open",void 0),l(this,"element",void 0),l(this,"is_loading",void 0),l(this,"isEmptyFolder",void 0),this.name="",this.isEmptyFolder=!1,this.load_on_demand=!1,this.setData(e),this.children=[],this.parent=null,t&&(this.idMapping=new Map,(this.tree=this).nodeClass=n)}l(w,"LEFT",37),l(w,"UP",38),l(w,"RIGHT",39),l(w,"DOWN",40);function H(a,e){function d(){return"simple_widget_".concat(e)}function l(e,t){return(t=jQuery.data(e,t))&&t instanceof O?t:null}function o(e,t){var n,i=d(),o=m(e.get());try{for(o.s();!(n=o.n()).done;){var r,s=n.value;l(s,i)||(r=new a(s,t),jQuery.data(s,i)||jQuery.data(s,i,r),r.init())}}catch(e){o.e(e)}finally{o.f()}return e}jQuery.fn[e]=function(e){if(!e)return o(this,null);if("object"===u(e))return o(this,e);if("string"==typeof e&&"_"!==e[0]){e=e;if("destroy"===e)return function(e){var t,n=d(),i=m(e.get());try{for(i.s();!(t=i.n()).done;){var o=t.value,r=l(o,n);r&&r.destroy(),jQuery.removeData(o,n)}}catch(e){i.e(e)}finally{i.f()}}(this);if("get_widget_class"===e)return a;for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(e,t,n){var i,o=null,r=m(e.get());try{for(r.s();!(i=r.n()).done;){var s,a=i.value,l=jQuery.data(a,d());l&&l instanceof O&&((s=l[t])&&"function"==typeof s&&(o=s.apply(l,n)))}}catch(e){r.e(e)}finally{r.f()}return o}(this,e,n)}}}var O=(n(M,[{key:"destroy",value:function(){this.deinit()}},{key:"init",value:function(){}},{key:"deinit",value:function(){}}],[{key:"register",value:function(e,t){H(e,t)}}]),M);function M(e,t){a(this,M),l(this,"options",void 0),l(this,"$el",void 0),this.$el=jQuery(e);e=this.constructor.defaults;this.options=s(s({},e),t)}l(O,"defaults",{});function $(e){return{pageX:e.pageX,pageY:e.pageY,target:e.target,originalEvent:e}}function x(e,t){return{pageX:e.pageX,pageY:e.pageY,target:e.target,originalEvent:t}}var q=function(){d(r,O);var o=v(r);function r(){var n;a(this,r);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return l(c(n=o.call.apply(o,[this].concat(t))),"isMouseStarted",void 0),l(c(n),"mouseDownInfo",void 0),l(c(n),"mouseDelayTimer",void 0),l(c(n),"isMouseDelayMet",void 0),l(c(n),"mouseDown",function(e){0===e.button&&n.handleMouseDown($(e))&&e.cancelable&&e.preventDefault()}),l(c(n),"mouseMove",function(e){n.handleMouseMove(e,$(e))}),l(c(n),"mouseUp",function(e){n.handleMouseUp($(e))}),l(c(n),"touchStart",function(e){var t;!e||1<e.touches.length||(t=e.changedTouches[0],n.handleMouseDown(x(t,e)))}),l(c(n),"touchMove",function(e){var t;!e||1<e.touches.length||(t=e.changedTouches[0],n.handleMouseMove(e,x(t,e)))}),l(c(n),"touchEnd",function(e){var t;!e||1<e.touches.length||(t=e.changedTouches[0],n.handleMouseUp(x(t,e)))}),n}return n(r,[{key:"init",value:function(){var e=this.$el.get(0);e&&(e.addEventListener("mousedown",this.mouseDown,{passive:!1}),e.addEventListener("touchstart",this.touchStart,{passive:!1})),this.isMouseStarted=!1,this.mouseDelayTimer=null,this.isMouseDelayMet=!1,this.mouseDownInfo=null}},{key:"deinit",value:function(){var e=this.$el.get(0);e&&(e.removeEventListener("mousedown",this.mouseDown,{passive:!1}),e.removeEventListener("touchstart",this.touchStart,{passive:!1})),this.removeMouseMoveEventListeners()}},{key:"handleMouseDown",value:function(e){return this.isMouseStarted&&this.handleMouseUp(e),this.mouseDownInfo=e,!!this.mouseCapture(e)&&(this.handleStartMouse(),!0)}},{key:"handleStartMouse",value:function(){document.addEventListener("mousemove",this.mouseMove,{passive:!1}),document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("mouseup",this.mouseUp,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1});var e=this.getMouseDelay();e?this.startMouseDelayTimer(e):this.isMouseDelayMet=!0}},{key:"startMouseDelayTimer",value:function(e){var t=this;this.mouseDelayTimer&&clearTimeout(this.mouseDelayTimer),this.mouseDelayTimer=window.setTimeout(function(){t.mouseDownInfo&&(t.isMouseDelayMet=!0)},e),this.isMouseDelayMet=!1}},{key:"handleMouseMove",value:function(e,t){if(this.isMouseStarted)return this.mouseDrag(t),void(e.cancelable&&e.preventDefault());this.isMouseDelayMet&&(this.mouseDownInfo&&(this.isMouseStarted=!1!==this.mouseStart(this.mouseDownInfo)),this.isMouseStarted?(this.mouseDrag(t),e.cancelable&&e.preventDefault()):this.handleMouseUp(t))}},{key:"handleMouseUp",value:function(e){this.removeMouseMoveEventListeners(),this.isMouseDelayMet=!1,this.mouseDownInfo=null,this.isMouseStarted&&(this.isMouseStarted=!1,this.mouseStop(e))}},{key:"removeMouseMoveEventListeners",value:function(){document.removeEventListener("mousemove",this.mouseMove,{passive:!1}),document.removeEventListener("touchmove",this.touchMove,{passive:!1}),document.removeEventListener("mouseup",this.mouseUp,{passive:!1}),document.removeEventListener("touchend",this.touchEnd,{passive:!1})}}]),r}(),B=(n(ie,[{key:"saveState",value:function(){var e=JSON.stringify(this.getState());this.treeWidget.options.onSetStateFromStorage?this.treeWidget.options.onSetStateFromStorage(e):this.supportsLocalStorage()&&localStorage.setItem(this.getKeyName(),e)}},{key:"getStateFromStorage",value:function(){var e=this.loadFromStorage();return e?this.parseState(e):null}},{key:"getState",value:function(){var t,n;return{open_nodes:(n=[],this.treeWidget.tree.iterate(function(e){return e.is_open&&e.id&&e.hasChildren()&&n.push(e.id),!0}),n),selected_node:(t=[],this.treeWidget.getSelectedNodes().forEach(function(e){null!=e.id&&t.push(e.id)}),t)}}},{key:"setInitialState",value:function(e){if(e){var t=!1;return e.open_nodes&&(t=this.openInitialNodes(e.open_nodes)),e.selected_node&&(this.resetSelection(),this.selectInitialNodes(e.selected_node)),t}return!1}},{key:"setInitialStateOnDemand",value:function(e,t){e?this.doSetInitialStateOnDemand(e.open_nodes,e.selected_node,t):t()}},{key:"getNodeIdToBeSelected",value:function(){var e=this.getStateFromStorage();return e&&e.selected_node?e.selected_node[0]:null}},{key:"parseState",value:function(e){var t,e=JSON.parse(e);return e&&e.selected_node&&"number"==typeof(t=e.selected_node)&&t%1==0&&(e.selected_node=[e.selected_node]),e}},{key:"loadFromStorage",value:function(){return this.treeWidget.options.onGetStateFromStorage?this.treeWidget.options.onGetStateFromStorage():this.supportsLocalStorage()?localStorage.getItem(this.getKeyName()):null}},{key:"openInitialNodes",value:function(e){var t,n=!1,i=m(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,r=this.treeWidget.getNodeById(o);r&&(r.load_on_demand?n=!0:r.is_open=!0)}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"selectInitialNodes",value:function(e){var t,n=0,i=m(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,r=this.treeWidget.getNodeById(o);r&&(n+=1,this.treeWidget.selectNodeHandler.addToSelection(r))}}catch(e){i.e(e)}finally{i.f()}return 0!==n}},{key:"resetSelection",value:function(){var t=this.treeWidget.selectNodeHandler;t.getSelectedNodes().forEach(function(e){t.removeFromSelection(e)})}},{key:"doSetInitialStateOnDemand",value:function(e,r,s){var a=this,l=0,d=e,u=function(){var e,t=[],n=m(d);try{for(n.s();!(e=n.n()).done;){var i=e.value,o=a.treeWidget.getNodeById(i);o?o.is_loading||(o.load_on_demand?(l+=1,a.treeWidget._openNode(o,!1,function(){--l,u()})):a.treeWidget._openNode(o,!1,null)):t.push(i)}}catch(e){n.e(e)}finally{n.f()}d=t,a.selectInitialNodes(r)&&a.treeWidget._refreshElements(null),0===l&&s()};u()}},{key:"getKeyName",value:function(){return"string"==typeof this.treeWidget.options.saveState?this.treeWidget.options.saveState:"tree"}},{key:"supportsLocalStorage",value:function(){return null==this._supportsLocalStorage&&(this._supportsLocalStorage=function(){if(null==localStorage)return!1;try{var e="_storage_test";sessionStorage.setItem(e,"value"),sessionStorage.removeItem(e)}catch(e){return!1}return!0}()),this._supportsLocalStorage}}]),ie),Q=(n(ne,[{key:"checkScrolling",value:function(){this.ensureInit(),this.checkVerticalScrolling(),this.checkHorizontalScrolling()}},{key:"scrollToY",value:function(e){var t;this.ensureInit(),this.$scrollParent?this.$scrollParent[0].scrollTop=e:(t=(t=this.treeWidget.$el.offset())?t.top:0,jQuery(document).scrollTop(e+t))}},{key:"isScrolledIntoView",value:function(e){this.ensureInit();var t,n,i,o=e.height()||0;return(this.$scrollParent?(t=0,n=this.$scrollParent.height()||0,(i=((i=e.offset())?i.top:0)-this.scrollParentTop)+o):(n=(t=jQuery(window).scrollTop()||0)+(jQuery(window).height()||0),(i=(e=e.offset())?e.top:0)+o))<=n&&t<=i}},{key:"getScrollLeft",value:function(){return this.$scrollParent&&this.$scrollParent.scrollLeft()||0}},{key:"initScrollParent",value:function(){function e(){s.scrollParentTop=0,s.$scrollParent=null}var s=this;"fixed"===this.treeWidget.$el.css("position")&&e();var t=function(){function e(e){var t,n=m(r);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=e.css(i);if("auto"===o||"scroll"===o)return 1}}catch(e){n.e(e)}finally{n.f()}}var r=["overflow","overflow-y"];if(e(s.treeWidget.$el))return s.treeWidget.$el;var t,n=m(s.treeWidget.$el.parents().get());try{for(n.s();!(t=n.n()).done;){var i=t.value,o=jQuery(i);if(e(o))return o}}catch(e){n.e(e)}finally{n.f()}return null}();t&&t.length&&"HTML"!==t[0].tagName?(this.$scrollParent=t,t=this.$scrollParent.offset(),this.scrollParentTop=t?t.top:0):e(),this.isInitialized=!0}},{key:"ensureInit",value:function(){this.isInitialized||this.initScrollParent()}},{key:"handleVerticalScrollingWithScrollParent",value:function(e){var t=this.$scrollParent&&this.$scrollParent[0];t&&(this.scrollParentTop+t.offsetHeight-e.bottom<20?(t.scrollTop+=20,this.treeWidget.refreshHitAreas(),this.previousTop=-1):e.top-this.scrollParentTop<20&&(t.scrollTop-=20,this.treeWidget.refreshHitAreas(),this.previousTop=-1))}},{key:"handleVerticalScrollingWithDocument",value:function(e){var t=jQuery(document).scrollTop()||0;e.top-t<20?jQuery(document).scrollTop(t-20):(jQuery(window).height()||0)-(e.bottom-t)<20&&jQuery(document).scrollTop(t+20)}},{key:"checkVerticalScrolling",value:function(){var e=this.treeWidget.dndHandler.hoveredArea;e&&e.top!==this.previousTop&&(this.previousTop=e.top,this.$scrollParent?this.handleVerticalScrollingWithScrollParent(e):this.handleVerticalScrollingWithDocument(e))}},{key:"checkHorizontalScrolling",value:function(){var e=this.treeWidget.dndHandler.positionInfo;e&&(this.$scrollParent?this.handleHorizontalScrollingWithParent(e):this.handleHorizontalScrollingWithDocument(e))}},{key:"handleHorizontalScrollingWithParent",value:function(e){var t,n,i,o,r;void 0!==e.pageX&&void 0!==e.pageY&&(r=(o=this.$scrollParent)&&o.offset(),o&&r&&(n=(t=o[0]).scrollLeft+t.clientWidth<t.scrollWidth,i=0<t.scrollLeft,o=r.left+t.clientWidth,r=r.left,o=e.pageX>o-20,r=e.pageX<r+20,o&&n?t.scrollLeft=Math.min(t.scrollLeft+20,t.scrollWidth):r&&i&&(t.scrollLeft=Math.max(t.scrollLeft-20,0))))}},{key:"handleHorizontalScrollingWithDocument",value:function(e){var t,n,i,o;void 0!==e.pageX&&void 0!==e.pageY&&(n=(t=jQuery(document)).scrollLeft()||0,o=jQuery(window).width()||0,i=0<n,o=e.pageX>o-20,e=e.pageX-n<20,o?t.scrollLeft(n+20):e&&i&&t.scrollLeft(Math.max(n-20,0)))}}]),ne),U=(n(te,[{key:"getSelectedNode",value:function(){var e=this.getSelectedNodes();return!!e.length&&e[0]}},{key:"getSelectedNodes",value:function(){var t=this;if(this.selectedSingleNode)return[this.selectedSingleNode];var n=[];return this.selectedNodes.forEach(function(e){e=t.treeWidget.getNodeById(e);e&&n.push(e)}),n}},{key:"getSelectedNodesUnder",value:function(e){if(this.selectedSingleNode)return e.isParentOf(this.selectedSingleNode)?[this.selectedSingleNode]:[];var t,n,i=[];for(t in this.selectedNodes)!Object.prototype.hasOwnProperty.call(this.selectedNodes,t)||(n=this.treeWidget.getNodeById(t))&&e.isParentOf(n)&&i.push(n);return i}},{key:"isNodeSelected",value:function(e){return null!=e.id?this.selectedNodes.has(e.id):!!this.selectedSingleNode&&this.selectedSingleNode.element===e.element}},{key:"clear",value:function(){this.selectedNodes.clear(),this.selectedSingleNode=null}},{key:"removeFromSelection",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];null==e.id?this.selectedSingleNode&&e.element===this.selectedSingleNode.element&&(this.selectedSingleNode=null):(this.selectedNodes.delete(e.id),n&&e.iterate(function(){return null!=e.id&&t.selectedNodes.delete(e.id),!0}))}},{key:"addToSelection",value:function(e){null!=e.id?this.selectedNodes.add(e.id):this.selectedSingleNode=e}},{key:"isFocusOnTree",value:function(){var e=document.activeElement;return Boolean(e&&"SPAN"===e.tagName&&this.treeWidget._containsElement(e))}}]),te),R=(n(ee,[{key:"init",value:function(e,t){this.node=e,this.treeWidget=t,e.element||(t=this.treeWidget.element.get(0))&&(e.element=t),e.element&&(this.$element=jQuery(e.element))}},{key:"addDropHint",value:function(e){return this.mustShowBorderDropHint(e)?new Y(this.$element,this.treeWidget._getScrollLeft()):new z(this.node,this.$element,e)}},{key:"select",value:function(e){var t=this.getLi();t.addClass("jqtree-selected"),t.attr("aria-selected","true");var n=this.getSpan();n.attr("tabindex",null!==(t=this.treeWidget.options.tabIndex)&&void 0!==t?t:null),e&&n.trigger("focus")}},{key:"deselect",value:function(){var e=this.getLi();e.removeClass("jqtree-selected"),e.attr("aria-selected","false");e=this.getSpan();e.removeAttr("tabindex"),e.blur()}},{key:"getUl",value:function(){return this.$element.children("ul:first")}},{key:"getSpan",value:function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")}},{key:"getLi",value:function(){return this.$element}},{key:"mustShowBorderDropHint",value:function(e){return e===y.Inside}}]),ee),X=function(){d(t,R);var e=v(t);function t(){return a(this,t),e.apply(this,arguments)}return n(t,[{key:"open",value:function(e){var t,n,i=this,o=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"fast";this.node.is_open||(this.node.is_open=!0,(t=this.getButton()).removeClass("jqtree-closed"),t.html(""),(t=t.get(0))&&(n=this.treeWidget.renderer.openedIconElement.cloneNode(!0),t.appendChild(n)),n=function(){i.getLi().removeClass("jqtree-closed"),i.getSpan().attr("aria-expanded","true"),e&&e(i.node),i.treeWidget._triggerEvent("tree.open",{node:i.node})},o?this.getUl().slideDown(r,n):(this.getUl().show(),n()))}},{key:"close",value:function(){var e,t,n=this,i=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"fast";this.node.is_open&&(this.node.is_open=!1,(e=this.getButton()).addClass("jqtree-closed"),e.html(""),(e=e.get(0))&&(t=this.treeWidget.renderer.closedIconElement.cloneNode(!0),e.appendChild(t)),t=function(){n.getLi().addClass("jqtree-closed"),n.getSpan().attr("aria-expanded","false"),n.treeWidget._triggerEvent("tree.close",{node:n.node})},i?this.getUl().slideUp(o,t):(this.getUl().hide(),t()))}},{key:"mustShowBorderDropHint",value:function(e){return!this.node.is_open&&e===y.Inside}},{key:"getButton",value:function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")}}]),t}(),Y=(n(Z,[{key:"remove",value:function(){this.$hint.remove()}}]),Z),z=(n(J,[{key:"remove",value:function(){this.$ghost.remove()}},{key:"moveAfter",value:function(){this.$element.after(this.$ghost)}},{key:"moveBefore",value:function(){this.$element.before(this.$ghost)}},{key:"moveInsideOpenFolder",value:function(){var e=this.node.children[0].element;e&&jQuery(e).before(this.$ghost)}},{key:"moveInside",value:function(){this.$element.after(this.$ghost),this.$ghost.addClass("jqtree-inside")}}]),J),G="Node parameter is empty",V="Parameter is empty: ",K=function(){d(r,q);var o=v(r);function r(){var n;a(this,r);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return l(c(n=o.call.apply(o,[this].concat(t))),"element",void 0),l(c(n),"tree",void 0),l(c(n),"dndHandler",void 0),l(c(n),"renderer",void 0),l(c(n),"dataLoader",void 0),l(c(n),"scrollHandler",void 0),l(c(n),"selectNodeHandler",void 0),l(c(n),"isInitialized",void 0),l(c(n),"saveStateHandler",void 0),l(c(n),"keyHandler",void 0),l(c(n),"handleClick",function(e){var t=n.getClickTarget(e.target);t&&("button"===t.type?(n.toggle(t.node,n.options.slide),e.preventDefault(),e.stopPropagation()):"label"===t.type&&(t=t.node,n._triggerEvent("tree.click",{node:t,click_event:e}).isDefaultPrevented()||n.doSelectNode(t)))}),l(c(n),"handleDblclick",function(e){var t=n.getClickTarget(e.target);"label"===(null==t?void 0:t.type)&&n._triggerEvent("tree.dblclick",{node:t.node,click_event:e})}),l(c(n),"handleContextmenu",function(e){var t=jQuery(e.target).closest("ul.jqtree-tree .jqtree-element");if(t.length){t=n.getNode(t);if(t)return e.preventDefault(),e.stopPropagation(),n._triggerEvent("tree.contextmenu",{node:t,click_event:e}),!1}return null}),n}return n(r,[{key:"toggle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw Error(G);t=null!=t?t:this.options.slide;return e.is_open?this.closeNode(e,t):this.openNode(e,t),this.element}},{key:"getTree",value:function(){return this.tree}},{key:"selectNode",value:function(e,t){return this.doSelectNode(e,t),this.element}},{key:"getSelectedNode",value:function(){return this.selectNodeHandler.getSelectedNode()}},{key:"toJson",value:function(){return JSON.stringify(this.tree.getData())}},{key:"loadData",value:function(e,t){return this.doLoadData(e,t),this.element}},{key:"loadDataFromUrl",value:function(e,t,n){return"string"==typeof e?this.doLoadDataFromUrl(e,t,null!=n?n:null):this.doLoadDataFromUrl(null,e,t),this.element}},{key:"reload",value:function(e){return this.doLoadDataFromUrl(null,null,e),this.element}},{key:"refresh",value:function(){return this._refreshElements(null),this.element}},{key:"getNodeById",value:function(e){return this.tree.getNodeById(e)}},{key:"getNodeByName",value:function(e){return this.tree.getNodeByName(e)}},{key:"getNodeByNameMustExist",value:function(e){return this.tree.getNodeByNameMustExist(e)}},{key:"getNodesByProperty",value:function(e,t){return this.tree.getNodesByProperty(e,t)}},{key:"getNodeByHtmlElement",value:function(e){return this.getNode(jQuery(e))}},{key:"getNodeByCallback",value:function(e){return this.tree.getNodeByCallback(e)}},{key:"openNode",value:function(e,t,n){var i=this;if(!e)throw Error(G);var o,r,r=f(("function"==typeof t?(o=t,r=null):(r=t,o=n),[r=null==r?null!==(i=i.options.slide)&&void 0!==i&&i:r,o]),2),o=r[0],r=r[1];return this._openNode(e,o,r),this.element}},{key:"closeNode",value:function(e,t){if(!e)throw Error(G);t=null!=t?t:this.options.slide;return(e.isFolder()||e.isEmptyFolder)&&(new X(e,this).close(t,this.options.animationSpeed),this.saveState()),this.element}},{key:"isDragging",value:function(){return this.dndHandler.isDragging}},{key:"refreshHitAreas",value:function(){return this.dndHandler.refresh(),this.element}},{key:"addNodeAfter",value:function(e,t){e=t.addAfter(e);return e&&this._refreshElements(t.parent),e}},{key:"addNodeBefore",value:function(e,t){if(!t)throw Error(V+"existingNode");e=t.addBefore(e);return e&&this._refreshElements(t.parent),e}},{key:"addParentNode",value:function(e,t){if(!t)throw Error(V+"existingNode");e=t.addParent(e);return e&&this._refreshElements(e.parent),e}},{key:"removeNode",value:function(e){if(!e)throw Error(G);if(!e.parent)throw Error("Node has no parent");this.selectNodeHandler.removeFromSelection(e,!0);var t=e.parent;return e.remove(),this._refreshElements(t),this.element}},{key:"appendNode",value:function(e,t){t=t||this.tree,e=t.append(e);return this._refreshElements(t),e}},{key:"prependNode",value:function(e,t){t=null!=t?t:this.tree,e=t.prepend(e);return this._refreshElements(t),e}},{key:"updateNode",value:function(e,t){if(!e)throw Error(G);var n="object"===u(t)&&t.id&&t.id!==e.id;return n&&this.tree.removeNodeFromIndex(e),e.setData(t),n&&this.tree.addNodeToIndex(e),"object"===u(t)&&t.children&&t.children instanceof Array&&(e.removeChildren(),t.children.length&&e.loadFromData(t.children)),this._refreshElements(e),this.element}},{key:"isSelectedNodeInSubtree",value:function(e){var t=this.getSelectedNode();return!!t&&(e===t||e.isParentOf(t))}},{key:"moveNode",value:function(e,t,n){if(!e)throw Error(G);if(!t)throw Error(V+"targetNode");n=_[n];return void 0!==n&&(this.tree.moveNode(e,t,n),this._refreshElements(null)),this.element}},{key:"getStateFromStorage",value:function(){return this.saveStateHandler.getStateFromStorage()}},{key:"addToSelection",value:function(e,t){if(!e)throw Error(G);return this.selectNodeHandler.addToSelection(e),this._getNodeElementForNode(e).select(void 0===t||t),this.saveState(),this.element}},{key:"getSelectedNodes",value:function(){return this.selectNodeHandler.getSelectedNodes()}},{key:"isNodeSelected",value:function(e){if(!e)throw Error(G);return this.selectNodeHandler.isNodeSelected(e)}},{key:"removeFromSelection",value:function(e){if(!e)throw Error(G);return this.selectNodeHandler.removeFromSelection(e),this._getNodeElementForNode(e).deselect(),this.saveState(),this.element}},{key:"scrollToNode",value:function(e){if(!e)throw Error(G);var t=jQuery(e.element).offset(),e=t?t.top:0,t=this.$el.offset(),t=e-(t?t.top:0);return this.scrollHandler.scrollToY(t),this.element}},{key:"getState",value:function(){return this.saveStateHandler.getState()}},{key:"setState",value:function(e){return this.saveStateHandler.setInitialState(e),this._refreshElements(null),this.element}},{key:"setOption",value:function(e,t){return this.options[e]=t,this.element}},{key:"moveDown",value:function(){var e=this.getSelectedNode();return e&&this.keyHandler.moveDown(e),this.element}},{key:"moveUp",value:function(){var e=this.getSelectedNode();return e&&this.keyHandler.moveUp(e),this.element}},{key:"getVersion",value:function(){return"1.6.2"}},{key:"_triggerEvent",value:function(e,t){t=jQuery.Event(e,t);return this.element.trigger(t),t}},{key:"_openNode",value:function(e){function t(e,t,n){new X(e,i).open(n,t,i.options.animationSpeed)}var i=this,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=2<arguments.length?arguments[2]:void 0;if(e.isFolder()||e.isEmptyFolder)if(e.load_on_demand)this.loadFolderOnDemand(e,n,o);else{for(var r=e.parent;r;)r.parent&&t(r,!1,null),r=r.parent;t(e,n,o),this.saveState()}}},{key:"_refreshElements",value:function(e){var t=this.selectNodeHandler.isFocusOnTree(),n=!!e&&this.isSelectedNodeInSubtree(e);this.renderer.render(e),n&&this.selectCurrentNode(t),this._triggerEvent("tree.refresh")}},{key:"_getNodeElementForNode",value:function(e){return new(e.isFolder()?X:R)(e,this)}},{key:"_getNodeElement",value:function(e){e=this.getNode(e);return e?this._getNodeElementForNode(e):null}},{key:"_containsElement",value:function(e){e=this.getNode(jQuery(e));return null!=e&&e.tree===this.tree}},{key:"_getScrollLeft",value:function(){return this.scrollHandler.getScrollLeft()}},{key:"init",value:function(){t(h(r.prototype),"init",this).call(this),this.element=this.$el,this.isInitialized=!1,this.options.rtl=this.getRtlOption(),null==this.options.closedIcon&&(this.options.closedIcon=this.getDefaultClosedIcon()),this.renderer=new E(this),this.dataLoader=new C(this),this.saveStateHandler=new B(this),this.selectNodeHandler=new U(this),this.dndHandler=new D(this),this.scrollHandler=new Q(this),this.keyHandler=new w(this),this.initData(),this.element.on("click",this.handleClick),this.element.on("dblclick",this.handleDblclick),this.options.useContextMenu&&this.element.on("contextmenu",this.handleContextmenu)}},{key:"deinit",value:function(){this.element.empty(),this.element.off(),this.keyHandler.deinit(),this.tree=new b({},!0),t(h(r.prototype),"deinit",this).call(this)}},{key:"mouseCapture",value:function(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseCapture(e)}},{key:"mouseStart",value:function(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseStart(e)}},{key:"mouseDrag",value:function(e){if(this.options.dragAndDrop){e=this.dndHandler.mouseDrag(e);return this.scrollHandler.checkScrolling(),e}return!1}},{key:"mouseStop",value:function(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseStop(e)}},{key:"getMouseDelay",value:function(){var e;return null!==(e=this.options.startDndDelay)&&void 0!==e?e:0}},{key:"initData",value:function(){this.options.data?this.doLoadData(this.options.data,null):this.getDataUrlInfo(null)?this.doLoadDataFromUrl(null,null,null):this.doLoadData([],null)}},{key:"getDataUrlInfo",value:function(n){function e(e){var t;null!=n&&n.id?(t={node:n.id},e.data=t):(t=i.getNodeIdToBeSelected())&&(e.data={selected_node:t})}var t,i=this,o=this.options.dataUrl||this.element.data("url");return"function"==typeof o?o(n):"string"==typeof o?(e(t={url:o}),t):o&&"object"===u(o)?(e(o),o):null}},{key:"getNodeIdToBeSelected",value:function(){return this.options.saveState?this.saveStateHandler.getNodeIdToBeSelected():null}},{key:"initTree",value:function(e){function t(){n.isInitialized||(n.isInitialized=!0,n._triggerEvent("tree.init"))}var n=this;this.options.nodeClass&&(this.tree=new this.options.nodeClass(null,!0,this.options.nodeClass),this.selectNodeHandler.clear(),this.tree.loadFromData(e),e=this.setInitialState(),this._refreshElements(null),e?this.setInitialStateOnDemand(t):t())}},{key:"setInitialState",value:function(){var t=this,e=f(function(){if(t.options.saveState){var e=t.saveStateHandler.getStateFromStorage();return e?[!0,t.saveStateHandler.setInitialState(e)]:[!1,!1]}return[!1,!1]}(),2),n=e[0],e=e[1];return e=!n?function(){if(!1===t.options.autoOpen)return!1;var n=t.getAutoOpenMaxLevel(),i=!1;return t.tree.iterate(function(e,t){return e.load_on_demand?!(i=!0):!!e.hasChildren()&&(e.is_open=!0,t!==n)}),i}():e}},{key:"setInitialStateOnDemand",value:function(t){var n,i,o,r,s=this;!function(){if(s.options.saveState){var e=s.saveStateHandler.getStateFromStorage();return e&&(s.saveStateHandler.setInitialStateOnDemand(e,t),1)}}()&&(n=s.getAutoOpenMaxLevel(),i=0,o=function(e){i+=1,s._openNode(e,!1,function(){--i,r()})},(r=function(){s.tree.iterate(function(e,t){return e.load_on_demand?(e.is_loading||o(e),!1):(s._openNode(e,!1,null),t!==n)}),0===i&&t()})())}},{key:"getAutoOpenMaxLevel",value:function(){return!0===this.options.autoOpen?-1:"number"==typeof this.options.autoOpen?this.options.autoOpen:"string"==typeof this.options.autoOpen?parseInt(this.options.autoOpen,10):0}},{key:"getClickTarget",value:function(e){var t=jQuery(e),e=t.closest(".jqtree-toggler");if(e.length){e=this.getNode(e);if(e)return{type:"button",node:e}}else{t=t.closest(".jqtree-element");if(t.length){t=this.getNode(t);if(t)return{type:"label",node:t}}}return null}},{key:"getNode",value:function(e){e=e.closest("li.jqtree_common");return 0===e.length?null:e.data("node")}},{key:"saveState",value:function(){this.options.saveState&&this.saveStateHandler.saveState()}},{key:"selectCurrentNode",value:function(e){var t=this.getSelectedNode();!t||(t=this._getNodeElementForNode(t))&&t.select(e)}},{key:"deselectCurrentNode",value:function(){var e=this.getSelectedNode();e&&this.removeFromSelection(e)}},{key:"getDefaultClosedIcon",value:function(){return this.options.rtl?"&#x25c0;":"&#x25ba;"}},{key:"getRtlOption",value:function(){if(null!=this.options.rtl)return this.options.rtl;var e=this.element.data("rtl");return null!==e&&!1!==e&&void 0!==e}},{key:"doSelectNode",value:function(e,t){function n(){i.options.saveState&&i.saveStateHandler.saveState()}var i=this;if(!e)return this.deselectCurrentNode(),void n();var o=s(s({},{mustSetFocus:!0,mustToggle:!0}),t||{});(i.options.onCanSelectNode?!0===i.options.selectable&&i.options.onCanSelectNode(e):!0===i.options.selectable)&&(this.selectNodeHandler.isNodeSelected(e)?o.mustToggle&&(this.deselectCurrentNode(),this._triggerEvent("tree.select",{node:null,previous_node:e})):(t=this.getSelectedNode()||null,this.deselectCurrentNode(),this.addToSelection(e,o.mustSetFocus),this._triggerEvent("tree.select",{node:e,deselected_node:t}),(e=e.parent)&&e.parent&&!e.is_open&&i.openNode(e,!1)),n())}},{key:"doLoadData",value:function(e,t){e&&(this._triggerEvent("tree.load_data",{tree_data:e}),t?(this.deselectNodes(t),this.loadSubtree(e,t)):this.initTree(e),this.isDragging()&&this.dndHandler.refresh())}},{key:"deselectNodes",value:function(e){var t,n=m(this.selectNodeHandler.getSelectedNodesUnder(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;this.selectNodeHandler.removeFromSelection(i)}}catch(e){n.e(e)}finally{n.f()}}},{key:"loadSubtree",value:function(e,t){t.loadFromData(e),t.load_on_demand=!1,t.is_loading=!1,this._refreshElements(t)}},{key:"doLoadDataFromUrl",value:function(e,t,n){e=e||this.getDataUrlInfo(t);this.dataLoader.loadFromUrl(e,t,n)}},{key:"loadFolderOnDemand",value:function(e){var t=this,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=2<arguments.length?arguments[2]:void 0;e.is_loading=!0,this.doLoadDataFromUrl(null,e,function(){t._openNode(e,n,i)})}}]),r}();function J(e,t,n){a(this,J),l(this,"$element",void 0),l(this,"node",void 0),l(this,"$ghost",void 0),this.$element=t,this.node=e,this.$ghost=jQuery('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span>\n            <span class="jqtree_common jqtree-line"></span></li>'),n===y.After?this.moveAfter():n===y.Before?this.moveBefore():n===y.Inside&&(e.isFolder()&&e.is_open?this.moveInsideOpenFolder():this.moveInside())}function Z(e,t){a(this,Z),l(this,"$hint",void 0);var n=e.children(".jqtree-element"),e=e.width()||0,e=Math.max(e+t-4,0),t=n.outerHeight()||0,t=Math.max(t-4,0);this.$hint=jQuery('<span class="jqtree-border"></span>'),n.append(this.$hint),this.$hint.css({width:e,height:t})}function ee(e,t){a(this,ee),l(this,"node",void 0),l(this,"$element",void 0),l(this,"treeWidget",void 0),this.init(e,t)}function te(e){a(this,te),l(this,"treeWidget",void 0),l(this,"selectedNodes",void 0),l(this,"selectedSingleNode",void 0),this.treeWidget=e,this.selectedNodes=new Set,this.clear()}function ne(e){a(this,ne),l(this,"treeWidget",void 0),l(this,"previousTop",void 0),l(this,"isInitialized",void 0),l(this,"$scrollParent",void 0),l(this,"scrollParentTop",void 0),this.treeWidget=e,this.previousTop=-1,this.isInitialized=!1}function ie(e){a(this,ie),l(this,"treeWidget",void 0),l(this,"_supportsLocalStorage",void 0),this.treeWidget=e}return l(K,"defaults",{animationSpeed:"fast",autoEscape:!0,autoOpen:!1,buttonLeft:!0,closedIcon:void 0,data:void 0,dataFilter:void 0,dataUrl:void 0,dragAndDrop:!1,keyboardSupport:!0,nodeClass:b,onCanMove:void 0,onCanMoveTo:void 0,onCanSelectNode:void 0,onCreateLi:void 0,onDragMove:void 0,onDragStop:void 0,onGetStateFromStorage:void 0,onIsMoveHandle:void 0,onLoadFailed:void 0,onLoading:void 0,onSetStateFromStorage:void 0,openedIcon:"&#x25bc;",openFolderDelay:500,rtl:void 0,saveState:!1,selectable:!0,showEmptyFolder:!1,slide:!0,startDndDelay:300,tabIndex:0,useContextMenu:!0}),O.register(K,"tree"),e.JqTreeWidget=K,Object.defineProperty(e,"__esModule",{value:!0}),e}({});